#!/usr/bin/env bash

echo "Pausing service and removing existing configuration..."
docker service update --detach=false pipeline_jenkins --config-rm pipeline-jobs --config-rm pipeline-config --replicas 0 || exit 1
echo "Replacing configuration..."
docker config rm pipeline-jobs
docker config rm pipeline-config
docker config create pipeline-jobs jobs.yaml
docker config create pipeline-config config.yaml
echo "Updating service with new configuration and resuming..."
docker service update --detach=false pipeline_jenkins --config-add source=pipeline-jobs,target=/jobs.yaml --config-add source=pipeline-config,target=/config.yaml --replicas 1
